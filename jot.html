<!doctype html>
<html>
  <head></head>
  <body>
    <script type="text/javascript">
      Task = function (context) {
        this.context = context;
        this.fn = null;
        this.inputEl = null;
        this.outputEl = null;
        return this;
      };

      Task.prototype.in = function (el) {
        this.inputEl = el;
        return this;
      };

      Task.prototype.out = function (el) {
        this.outputEl = el;
        return this;
      };

      Task.prototype.do = function (fn) {
        this.fn = fn;
        return this;
      };

      Task.prototype.run = function (fn) {
        this.fn = fn || this.fn;

        if (this.fn) {
          var out = this.fn.call(this.context);
          if (this.inputEl) 
            this.inputEl.innerHTML = this.fn.toString();
          if (this.outputEl)
            this.outputEl.innerHTML = JSON.stringify(out);
        }
        return this;
      };

      TaskSet = function () {
        this.context = {};
        this.tasks = [];
        return this;
      };

      TaskSet.prototype.createTask = function (inputEl, outputEl) {
        var task = new Task(this.context);

        if (!outputEl) {
          var container = getElement(inputEl);
          inputEl = document.createElement('code');
          outputEl = document.createElement('code');

          container.appendChild(inputEl);
          container.appendChild(outputEl);
        } else {
          inputEl = getElement(inputEl);
          outputEl = getElement(outputEl);
        }

        task.in(inputEl).out(outputEl);

        this.tasks.push(task);
        return task;
      };

      TaskSet.prototype.run = function () {
        this.tasks.forEach(function (task) { task.run(); });
        return this;
      };

      function getElement (query) {
        if (query instanceof Element) return query;
        if (query instanceof Array) return query[0];
        if (typeof query === 'string') return document.querySelector(query);
      };
    </script>

    <p> Run some code: </p>
    <div class="task1"></div>
    <script type="text/javascript">
      var notebook = new TaskSet();

      var task1 = notebook.createTask('.task1')
                          .run(function () { return 1; });
    </script>

  </body>
</html>